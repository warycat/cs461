var BJ=function(){function a(){console.log("Black Jack Initialized!"),u=0,t=[];for(var a=0;4>a;a++)for(var b=1;13>=b;b++)t.push({s:a,n:b,c:a%2})}function b(a){for(var b=0,c=0,d=0;d<a.length;d++){var e=a[d],f=t[e],g=p[f.n];11===g&&b++,c+=g}for(;c>21&&b>0;)c-=10,b--;return c}function c(){u++,UI.log("ROUND "+u),UI.buttons(["stand","hit","doubledown","surrender","split","start"],["bet2"])}function d(a){q[s]=a,s++}function e(){var a=q[r];return r++,a}function f(){for(var a=0;s>a;a++)console.log(q[a])}function g(a){console.log("readlogs");for(var b=0;b<a.length;b++)d(a[b])}function h(a){return t[a]}function i(a){var b=t[a];return p[b.n]}function j(){for(;r!==s;){var a=e();k(a)}}function k(a){var b=a.split(" "),d=b[0],e=b[1],f=b[2];"round"===d?(c(),Player.clear(),Dealer.clear(),UI.log("")):"deck"===d?"test"===e?Deck.test():"prepare"===e?Deck.prepare():"print"===e?Deck.print():UI.log(a):"player"===d?"draw"===e?Player.draw():"show"===e?Player.show():"clear"===e?Player.clear():"split"===e?Player.split():"print"===e?Player.print():"bet"===e?(console.log(f),Player.bet(f)):"hit"===e?Player.hit():"bust"===e?Player.bust():"nexthand"===e?Player.nexthand():"scores"===e?Player.scores():"doubledown"===e?Player.doubledown():"surrender"===e?Player.surrender():"stand"===e?Player.stand():UI.log(a):"dealer"===d?"clear"===e?Dealer.clear():"draw"===e?Dealer.draw():"show"===e?Dealer.show():"print"===e?Dealer.print():"rule"===e?Dealer.rule():"stand"===e?Dealer.stand():"bust"===e?Dealer.bust():"score"===e?Dealer.score():"hit"===e?Dealer.hit():UI.log(a):UI.log(a)}function l(){return u}var m=["♠","♥","♣","♦"],n=["#000000","#ff0000"],o=["","A","2","3","4","5","6","7","8","9","10","J","Q","K"],p=[0,11,2,3,4,5,6,7,8,9,10,10,10,10],q=[],r=0,s=0,t=[],u=0;return{suits:m,colors:n,names:o,values:p,init:a,score:b,enQueue:d,deQueue:e,processLog:k,printLogs:f,readLogs:g,loop:j,card:h,getRound:l,newRound:c,value:i}}();console.log(BJ);var UI=function(){function a(a){var b=$("<p>"+a+"<p>");j.append(b),console.log(B++,b.text()),h()}function b(){l.click(function(){BJ.enQueue("player bet 2")}),m.click(function(){BJ.enQueue("player stand")}),n.click(function(){BJ.enQueue("player hit")}),o.click(function(){BJ.enQueue("player doubledown")}),p.click(function(){BJ.enQueue("player split")}),q.click(function(){BJ.enQueue("player surrender")}),k.click(function(){BJ.enQueue("round")}),r.click(function(){j.empty()})}function c(a){var b=BJ.card(a);return BJ.suits[b.s]+BJ.names[b.n]}function d(a){var b=BJ.card(a);return'<span style="color:'+BJ.colors[b.c]+';">'+BJ.suits[b.s]+BJ.names[b.n]+"</span> "}function e(a,b){var c="";for(var e in a){var f=a[e];c+=e>=b?"#? ":d(f)}return c}function f(){return'<span style="color:#009000;font-weight:bold">PLAYER </span>'}function g(){return'<span style="color:#000090;font-weight:bold">DEALER </span>'}function h(){s.html(e(Dealer.getHand(),Dealer.getNShow())),t.html(e(Player.getHand(0),Player.getNShow(0))),u.html(e(Player.getHand(1),Player.getNShow(1))),v.html(e(Player.getHand(2),Player.getNShow(2))),w.html(e(Player.getHand(3),Player.getNShow(3))),z.text(BJ.getRound()),x.text(Player.getBet()),y.text(Player.getTotal()),A.text(Deck.getLeft());var a=Player.getH();$('span[id^="i"]').css("color","#000000"),$("#i"+a).css("color","#0000f0")}function i(a,b){var c={start:k,bet2:l,stand:m,hit:n,doubledown:o,split:p,surrender:q};for(var d in a){var e=a[d];c[e].hide()}for(var f in b){var g=b[f];c[g].show()}}var j=$("#log"),k=$("#start"),l=$("#bet2"),m=$("#stand"),n=$("#hit"),o=$("#doubledown"),p=$("#split"),q=$("#surrender"),r=$("#cleanup"),s=$("#dh"),t=$("#h0"),u=$("#h1"),v=$("#h2"),w=$("#h3"),x=$("#bet"),y=$("#total"),z=$("#round"),A=$("#deck"),B=0;return{log:a,configButtons:b,textCard:c,htmlCard:d,htmlCards:e,player:f,dealer:g,buttons:i}}();console.log(UI);var Deck=function(){function a(a){for(var b,c,d=a.length;d;)c=Math.floor(Math.random()*d--),b=a[d],a[d]=a[c],a[c]=b;return a}function b(){return g[h++]}function c(){g=[];for(var b=0;52>b;b++)g.push(b);a(g),a(g),a(g),a(g),h=0,UI.buttons(["bet2","stand","hit","doubledown","surrender","split"],["start"])}function d(){UI.log("DECK TEST"),g=[0,11,0,24,3,10,6,2,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],h=0}function e(){for(var a=[],b=h;52>b;b++)a.push(UI.textCard(g[b]));console.log(a.join())}function f(){return 52-h}var g,h;return{test:d,prepare:c,popCard:b,print:e,getLeft:f}}();console.log(Deck);var Dealer=function(){function a(){UI.log(UI.dealer()+"CLEAN TABLE"),l=[],m=0}function b(){var a=Deck.popCard();l.push(a),UI.log(UI.dealer()+"DRAW A CARD")}function c(){var a=l[l.length-1];UI.log(UI.dealer()+"SHOW "+UI.textCard(a)),m++}function d(){UI.log(UI.dealer()+"HIT"),Dealer.draw(),Dealer.show(),Dealer.rule()}function e(){UI.log(UI.dealer()+"STAND"),Dealer.score(),Player.scores()}function f(){UI.log(UI.dealer()+"BUST"),Dealer.score(),Player.scores()}function g(){UI.log(UI.dealer()+"RULE");var a=BJ.score(l);17>a?Dealer.hit():17===a?2===l.length?Dealer.hit():(Dealer.stand(),Player.match(22)):21>=a?(Dealer.stand(),Player.match(a)):(Dealer.bust(),Player.match(0))}function h(){for(var a=UI.dealer()+"H ",b=0;b<l.length;b++){var c=l[b];a+=UI.textCard(c),a+=" "}UI.log(a)}function i(){var a=UI.dealer()+"S ";a+=BJ.score(l),UI.log(a)}function j(){return l}function k(){return m}var l=[],m=0;return{clear:a,draw:b,show:c,hit:d,stand:e,print:h,rule:g,bust:f,score:i,getHand:j,getNShow:k}}();console.log(Dealer);var Player=function(){function a(){u=[[],[],[],[]],w=[0,0,0,0],v=0,x=1,y=[0,0,0,0],UI.log(UI.player()+"CLEAN TABLE")}function b(){var a=Deck.popCard(),b=u[v];b.push(a),UI.log(UI.player()+"DRAW A CARD")}function c(){var a=u[v],b=a[a.length-1];y[v]++,UI.log(UI.player()+"SHOW "+UI.textCard(b))}function d(a){a=parseInt(a),console.log(a),w[0]=a,z-=a,UI.log(UI.player()+"BET $"+a),Dealer.draw(),Dealer.show(),Player.draw(),Player.show(),Dealer.draw(),Player.draw(),Player.show(),UI.buttons(["start","bet2"],["stand","hit","doubledown","surrender"]),e()}function e(){var a=u[v],b=a[0],c=a[1];BJ.value(b)!==BJ.value(c)?UI.buttons(["split"],[]):UI.buttons([],["split"])}function f(){UI.log(UI.player()+"HIT"),Player.draw(),Player.show(),Player.print();var a=BJ.score(u[v]);a>21&&Player.bust(),UI.buttons(["doubledown","surrender"],[])}function g(){UI.log(UI.player()+"STAND"),Player.nexthand()}function h(){UI.log(UI.player()+"BUST"),Player.nexthand()}function i(){z-=w[v],w[v]*=2;var a=BJ.score(u[v]);UI.log(UI.player()+"DOUBLE DOWN"),Player.draw(),Player.show(),a>21?Player.bust():Player.stand()}function j(a){for(var b=0;x>b;b++){var c=u[b],d=BJ.score(c);21>=d&&(21===d&&2===c.length&&(d=22),d===a?z+=w[b]:d>a&&(z+=2*w[b]))}UI.log("")}function k(){var a=u[v],b=a[0],c=a[1];u.splice(v,1,[b],[c]),u.pop(),y[v]--,y[v+1]++,z-=w[v],w[v+1]=w[v],x++,UI.log(UI.player()+"SPLIT "+UI.htmlCard(b)+" "+UI.htmlCard(c)),Player.draw(),Player.show(),e()}function l(){UI.log(UI.player()+"SURRENDER"),w[v]/=2,z+=w[v],Player.nexthand()}function m(){x>v+1?(UI.log(UI.player()+"NEXT HAND"),v++,Player.draw(),Player.show(),UI.buttons(["start"],["stand","hit","doubledown","surrender","split"]),e()):(Dealer.show(),Dealer.rule(),UI.buttons(["stand","hit","doubledown","surrender","split"],["start"]))}function n(){for(var a=0;4>a;a++){for(var b=u[a],c=UI.player()+"H"+a+" ",d=0;d<b.length;d++){var e=b[d];c+=UI.textCard(e),c+=" "}UI.log(c)}}function o(){for(var a=0;4>a;a++){var b=u[a],c=UI.player()+"S"+a+" ",d=BJ.score(b);c+=d,UI.log(c)}}function p(a){return u[a]}function q(a){return y[a]}function r(){return w[v]}function s(){return z}function t(){return v}var u=[[],[],[],[]],v=0,w=[0,0,0,0],x=1,y=[0,0,0,0],z=0;return{clear:a,draw:b,show:c,bet:d,stand:g,hit:f,doubledown:i,split:k,surrender:l,bust:h,nexthand:m,scores:o,match:j,print:n,getHand:p,getNShow:q,getBet:r,getTotal:s,getH:t}}(),testLogs=["deck prepare"];BJ.init(),UI.configButtons(),BJ.readLogs(testLogs),BJ.loop(),setInterval(function(){BJ.loop()},1e3);